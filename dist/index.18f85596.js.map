{"mappings":"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","sources":["<anon>","pieces.ts","avis.ts"],"sourcesContent":["/* global Chart */ const $44576fbb643b2cd8$export$c71b61ff869f11fb = ()=>{\n    const piecesElements = document.querySelectorAll(\".fiches article button\");\n    for(let i = 0; i < piecesElements.length; i++)piecesElements[i].addEventListener(\"click\", async (event)=>{\n        const id = event.target.dataset.id;\n        //tester si les avis sont déja present dans le localStorage\n        let avis = window.localStorage.getItem(`avis-piece-${id}`);\n        if (avis === null) {\n            /* Code de récupération des pièces depuis l’API HTTP */ avis = await fetch(\"http://localhost:8081/pieces/\" + id + \"/avis\").then((avis)=>avis.json());\n            // Transformation des pièces en JSON\n            const valeurAvis = JSON.stringify(avis);\n            // Stockage des informations dans le localStorage\n            window.localStorage.setItem(`avis-piece-${id}`, valeurAvis);\n        } else avis = JSON.parse(avis);\n        const pieceElement = event.target.parentElement;\n        $44576fbb643b2cd8$export$333851ed8790b7cb(pieceElement, avis);\n    });\n};\nconst $44576fbb643b2cd8$export$333851ed8790b7cb = (pieceElement, avis)=>{\n    const avisElement = document.createElement(\"p\");\n    for(let i = 0; i < avis.length; i++)avisElement.innerHTML += `<b>${avis[i].utilisateur}:</b> ${avis[i].commentaire} <br>`;\n    pieceElement.appendChild(avisElement);\n};\nconst $44576fbb643b2cd8$export$9b3be3868f7b4f00 = ()=>{\n    const formulaireAvis = document.querySelector(\".formulaire-avis\");\n    formulaireAvis.addEventListener(\"submit\", (event)=>{\n        event.preventDefault();\n        // Création de l’objet du nouvel avis.\n        const avis = {\n            pieceId: parseInt(event.target.querySelector(\"input[name=piece-id]\").value),\n            utilisateur: event.target.querySelector(\"input[name=utilisateur\").value,\n            commentaire: event.target.querySelector(\"input[name=commentaire]\").value,\n            nbEtoiles: parseInt(event.target.querySelector(\"input[name=nbEtoiles]\").value)\n        };\n        const chargeUtile = JSON.stringify(avis);\n        fetch(\"http://localhost:8081/avis\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: chargeUtile\n        });\n    });\n};\nconst $44576fbb643b2cd8$export$3e0393f287d43ee8 = async ()=>{\n    // Calcul du nombre total de commentaires par quantité d'étoiles attribuées\n    const avis = await fetch(\"http://localhost:8081/avis\").then((avis)=>avis.json());\n    const nb_commentaires = [\n        0,\n        0,\n        0,\n        0,\n        0\n    ];\n    for (let commentaire of avis)nb_commentaires[commentaire.nbEtoiles - 1]++;\n    const labels = [\n        \"5\",\n        \"4\",\n        \"3\",\n        \"2\",\n        \"1\"\n    ];\n    const data = {\n        labels: labels,\n        datasets: [\n            {\n                label: \"\\xc9toiles attribu\\xe9es\",\n                data: nb_commentaires.reverse(),\n                backgroundColor: \"rgb(238, 0, 0)\"\n            }\n        ]\n    };\n    // Objet de configuration final\n    const config = {\n        type: \"bar\",\n        data: data,\n        options: {\n            indexAxis: \"y\"\n        }\n    };\n    // Rendu du graphique dans l'élément canvas\n    new Chart(document.querySelector(\"#graphique-avis\"), config);\n    // Recuperation des pieces depuis le localStorage\n    const piecesJSON = window.localStorage.getItem(\"pieces\");\n    const pieces = JSON.parse(piecesJSON);\n    //Calcul du nombre de commentaire \n    let nbCommentairesDispo = 0;\n    let nbCommentairesNonDispo = 0;\n    for(let i = 0; i < avis.length; i++){\n        const piece = pieces.find((piece)=>piece.id === avis[i].pieceId);\n        if (piece) {\n            if (piece.disponibilite) nbCommentairesDispo++;\n            else nbCommentairesNonDispo++;\n        }\n    }\n    const labelsDispo = [\n        \"Disponible\",\n        \"Non disponible\"\n    ];\n    const dataDispo = {\n        labels: labelsDispo,\n        datasets: [\n            {\n                label: \"Nombre de commentaires\",\n                data: [\n                    nbCommentairesDispo,\n                    nbCommentairesNonDispo\n                ],\n                backgroundColor: \"rgb(238, 0, 0)\"\n            }\n        ]\n    };\n    const configDispo = {\n        type: \"bar\",\n        data: dataDispo\n    };\n    new Chart(document.querySelector(\"#graphique-dispo\"), configDispo);\n};\n\n\n(0, $44576fbb643b2cd8$export$9b3be3868f7b4f00)();\n// Récupération des pièces depuis le fichier JSON\n// const reponse = await fetch(\"http://localhost:8081/pieces\")\n// const pieces = await reponse.json()\n// Récupération des pièces éventuellement stockées dans le localStorage\nlet $f7f2916509f4a77e$var$pieces = window.localStorage.getItem(\"pieces\");\nif ($f7f2916509f4a77e$var$pieces === null) {\n    /* Code de récupération des pièces depuis l’API HTTP */ $f7f2916509f4a77e$var$pieces = await fetch(\"http://localhost:8081/pieces\").then((pieces)=>pieces.json());\n    // Transformation des pièces en JSON\n    const valeurPieces = JSON.stringify($f7f2916509f4a77e$var$pieces);\n    // Stockage des informations dans le localStorage\n    window.localStorage.setItem(\"pieces\", valeurPieces);\n} else $f7f2916509f4a77e$var$pieces = JSON.parse($f7f2916509f4a77e$var$pieces);\nconst $f7f2916509f4a77e$var$sectionFiches = document.querySelector(\".fiches\");\n// Fonction qui génère toute la page web\nconst $f7f2916509f4a77e$var$genererPieces = (pieces)=>{\n    for(let i = 0; i < pieces.length; i++){\n        const article = pieces[i];\n        // Création d’une balise dédiée à une pièce auto\n        const pieceElement = document.createElement(\"article\");\n        pieceElement.dataset.id = pieces[i].id;\n        // Création des balises \n        const imageElement = document.createElement(\"img\");\n        imageElement.src = article.image;\n        const nomElement = document.createElement(\"h2\");\n        nomElement.innerText = article.nom;\n        const prixElement = document.createElement(\"p\");\n        prixElement.innerText = `Prix: ${article.prix} € (${article.prix < 35 ? \"€\" : \"€€€\"})`;\n        const categorieElement = document.createElement(\"p\");\n        categorieElement.innerText = article.categorie ?? \"(aucune cat\\xe9gorie)\";\n        const descriptionElement = document.createElement(\"p\");\n        descriptionElement.innerText = article.description ?? \"Pas de description pour le moment.\";\n        const stockElement = document.createElement(\"p\");\n        stockElement.innerText = article.disponibilite ? \"En stock\" : \"Rupture de stock\";\n        const avisBouton = document.createElement(\"button\");\n        avisBouton.dataset.id = article.id;\n        avisBouton.textContent = \"Afficher les avis\";\n        // On rattache la balise article a la section Fiches\n        $f7f2916509f4a77e$var$sectionFiches.appendChild(pieceElement);\n        // On rattache l’image à pieceElement (la balise article)\n        pieceElement.appendChild(imageElement);\n        pieceElement.appendChild(nomElement);\n        pieceElement.appendChild(prixElement);\n        pieceElement.appendChild(categorieElement);\n        //Ajout des éléments au DOM pour l'exercice\n        pieceElement.appendChild(descriptionElement);\n        pieceElement.appendChild(stockElement);\n        pieceElement.appendChild(avisBouton);\n    }\n    (0, $44576fbb643b2cd8$export$c71b61ff869f11fb)();\n};\n// Premier affichage de la page\n$f7f2916509f4a77e$var$genererPieces($f7f2916509f4a77e$var$pieces);\nfor(let i = 0; i < $f7f2916509f4a77e$var$pieces.length; i++){\n    const id = $f7f2916509f4a77e$var$pieces[i].id;\n    const avisJSON = window.localStorage.getItem(`avis-piece-${id}`);\n    const avis = JSON.parse(avisJSON);\n    console.log(avis);\n    if (avis !== null) {\n        const pieceElement = document.querySelector(`article[data-id=\"${id}\"]`);\n        (0, $44576fbb643b2cd8$export$333851ed8790b7cb)(pieceElement, avis);\n    }\n}\n// Ajout du listener pour trier les pièces par ordre de prix croissant\nconst $f7f2916509f4a77e$var$boutonTrier = document.querySelector(\".btn-trier\");\n$f7f2916509f4a77e$var$boutonTrier.addEventListener(\"click\", ()=>{\n    const piecesOrdonnees = Array.from($f7f2916509f4a77e$var$pieces);\n    piecesOrdonnees.sort((a, b)=>{\n        return a.prix - b.prix;\n    });\n    // Effacement de l'écran et regénération de la page\n    document.querySelector(\".fiches\").innerHTML = \"\";\n    $f7f2916509f4a77e$var$genererPieces(piecesOrdonnees);\n});\n// Ajout du listener pour filtrer les pièces non abordables\nconst $f7f2916509f4a77e$var$boutonFiltrer = document.querySelector(\".btn-filtrer\");\n$f7f2916509f4a77e$var$boutonFiltrer.addEventListener(\"click\", ()=>{\n    const piecesFiltrees = $f7f2916509f4a77e$var$pieces.filter((piece)=>{\n        return piece.prix <= 35;\n    });\n    // Effacement de l'écran et regénération de la page avec les pièces filtrées uniquement\n    document.querySelector(\".fiches\").innerHTML = \"\";\n    $f7f2916509f4a77e$var$genererPieces(piecesFiltrees);\n});\n//Tri decroissant\nconst $f7f2916509f4a77e$var$boutonDecroissant = document.querySelector(\".btn-decroissant\");\n$f7f2916509f4a77e$var$boutonDecroissant.addEventListener(\"click\", ()=>{\n    const piecesOrdonnees = Array.from($f7f2916509f4a77e$var$pieces);\n    piecesOrdonnees.sort((a, b)=>{\n        return b.prix - a.prix;\n    });\n    // Effacement de l'écran et regénération de la page\n    document.querySelector(\".fiches\").innerHTML = \"\";\n    $f7f2916509f4a77e$var$genererPieces(piecesOrdonnees);\n});\n//Filtre par catégorie\nconst $f7f2916509f4a77e$var$boutonNoDescription = document.querySelector(\".btn-nodesc\");\n$f7f2916509f4a77e$var$boutonNoDescription.addEventListener(\"click\", ()=>{\n    const piecesFiltrees = $f7f2916509f4a77e$var$pieces.filter((piece)=>{\n        return piece.description;\n    });\n    // Effacement de l'écran et regénération de la page avec les pièces filtrées uniquement\n    document.querySelector(\".fiches\").innerHTML = \"\";\n    $f7f2916509f4a77e$var$genererPieces(piecesFiltrees);\n});\n// Tableau des noms des pièces\nconst $f7f2916509f4a77e$var$noms = $f7f2916509f4a77e$var$pieces.map((piece)=>piece.nom);\nfor(let i = $f7f2916509f4a77e$var$pieces.length - 1; i >= 0; i--)if ($f7f2916509f4a77e$var$pieces[i].prix > 35) $f7f2916509f4a77e$var$noms.splice(i, 1);\nconsole.log($f7f2916509f4a77e$var$noms);\n//Création de la liste\nconst $f7f2916509f4a77e$var$abordablesElements = document.createElement(\"ul\");\n//Ajout de chaque nom à la liste\nfor(let i = 0; i < $f7f2916509f4a77e$var$noms.length; i++){\n    const nomElement = document.createElement(\"li\");\n    nomElement.innerText = $f7f2916509f4a77e$var$noms[i];\n    $f7f2916509f4a77e$var$abordablesElements.appendChild(nomElement);\n}\n// Ajout de l'en-tête puis de la liste au bloc résultats filtres\ndocument.querySelector(\".abordables\").appendChild($f7f2916509f4a77e$var$abordablesElements);\n//Code Exercice \nconst $f7f2916509f4a77e$var$nomsDisponibles = $f7f2916509f4a77e$var$pieces.map((piece)=>piece.nom);\nconst $f7f2916509f4a77e$var$prixDisponibles = $f7f2916509f4a77e$var$pieces.map((piece)=>piece.prix);\nfor(let i = $f7f2916509f4a77e$var$pieces.length - 1; i >= 0; i--)if ($f7f2916509f4a77e$var$pieces[i].disponibilite === false) {\n    $f7f2916509f4a77e$var$nomsDisponibles.splice(i, 1);\n    $f7f2916509f4a77e$var$prixDisponibles.splice(i, 1);\n}\nconst $f7f2916509f4a77e$var$disponiblesElement = document.createElement(\"ul\");\nfor(let i = 0; i < $f7f2916509f4a77e$var$nomsDisponibles.length; i++){\n    const nomElement = document.createElement(\"li\");\n    nomElement.innerText = `${$f7f2916509f4a77e$var$nomsDisponibles[i]} - ${$f7f2916509f4a77e$var$prixDisponibles[i]} €`;\n    $f7f2916509f4a77e$var$disponiblesElement.appendChild(nomElement);\n}\ndocument.querySelector(\".disponibles\").appendChild($f7f2916509f4a77e$var$disponiblesElement);\nconst $f7f2916509f4a77e$var$inputPrixMax = document.querySelector(\"#prix-max\");\n$f7f2916509f4a77e$var$inputPrixMax.addEventListener(\"input\", ()=>{\n    const piecesFiltrees = $f7f2916509f4a77e$var$pieces.filter((piece)=>{\n        return piece.prix <= $f7f2916509f4a77e$var$inputPrixMax.value;\n    });\n    document.querySelector(\".fiches\").innerHTML = \"\";\n    $f7f2916509f4a77e$var$genererPieces(piecesFiltrees);\n});\n// Ajout du listener pour mettre à jour des données du localStorage\nconst $f7f2916509f4a77e$var$boutonMettreAJour = document.querySelector(\".btn-maj\");\n$f7f2916509f4a77e$var$boutonMettreAJour.addEventListener(\"click\", ()=>{\n    window.localStorage.removeItem(\"pieces\");\n    for(let i = 0; i < $f7f2916509f4a77e$var$pieces.length; i++)window.localStorage.removeItem(\"avis-piece-\" + $f7f2916509f4a77e$var$pieces[i].id);\n});\n(0, $44576fbb643b2cd8$export$3e0393f287d43ee8)();\n\n\n//# sourceMappingURL=index.18f85596.js.map\n","import { ajoutListenersAvis, ajoutListenerEnvoyerAvis, afficherAvis, afficherGraphiqueAvis  } from \"./avis.js\";\r\n\r\najoutListenerEnvoyerAvis()\r\n// Récupération des pièces depuis le fichier JSON\r\n// const reponse = await fetch(\"http://localhost:8081/pieces\")\r\n\r\n// const pieces = await reponse.json()\r\n // Récupération des pièces éventuellement stockées dans le localStorage\r\nlet pieces = window.localStorage.getItem(\"pieces\");\r\n\r\nif (pieces === null) {\r\n  /* Code de récupération des pièces depuis l’API HTTP */\r\n  pieces = await fetch(\"http://localhost:8081/pieces\").then(pieces => pieces.json());\r\n\r\n   // Transformation des pièces en JSON\r\n   const valeurPieces = JSON.stringify(pieces);\r\n   // Stockage des informations dans le localStorage\r\n   window.localStorage.setItem(\"pieces\", valeurPieces);\r\n}else{\r\n    pieces = JSON.parse(pieces);\r\n }\r\n\r\n\r\nconst sectionFiches = document.querySelector(\".fiches\");\r\n// Fonction qui génère toute la page web\r\nconst genererPieces = (pieces) => {\r\n  for (let i = 0; i < pieces.length; i++) {\r\n    const article = pieces[i];\r\n    // Création d’une balise dédiée à une pièce auto\r\n    const pieceElement = document.createElement(\"article\");\r\n    pieceElement.dataset.id = pieces[i].id\r\n\r\n    // Création des balises \r\n    const imageElement = document.createElement(\"img\");\r\n    imageElement.src = article.image;\r\n    const nomElement = document.createElement(\"h2\");\r\n    nomElement.innerText = article.nom;\r\n    const prixElement = document.createElement(\"p\");\r\n    prixElement.innerText = `Prix: ${article.prix} € (${article.prix < 35 ? \"€\" : \"€€€\"})`;\r\n    const categorieElement = document.createElement(\"p\");\r\n    categorieElement.innerText = article.categorie ?? \"(aucune catégorie)\";\r\n    const descriptionElement = document.createElement(\"p\");\r\n    descriptionElement.innerText = article.description ?? \"Pas de description pour le moment.\";\r\n    const stockElement = document.createElement(\"p\");\r\n    stockElement.innerText = article.disponibilite ? \"En stock\" : \"Rupture de stock\";\r\n\r\n     const avisBouton = document.createElement(\"button\");\r\n     avisBouton.dataset.id = article.id;\r\n     avisBouton.textContent = \"Afficher les avis\";\r\n    \r\n    // On rattache la balise article a la section Fiches\r\n    sectionFiches.appendChild(pieceElement);\r\n    // On rattache l’image à pieceElement (la balise article)\r\n    pieceElement.appendChild(imageElement);\r\n    pieceElement.appendChild(nomElement);\r\n    pieceElement.appendChild(prixElement);\r\n    pieceElement.appendChild(categorieElement);\r\n    //Ajout des éléments au DOM pour l'exercice\r\n    pieceElement.appendChild(descriptionElement);\r\n    pieceElement.appendChild(stockElement);\r\n\r\n    \r\n    pieceElement.appendChild(avisBouton);\r\n    \r\n}\r\najoutListenersAvis();\r\n \r\n}\r\n \r\n// Premier affichage de la page\r\ngenererPieces(pieces);\r\n\r\n\r\n\r\nfor (let i = 0; i < pieces.length; i++) {\r\n    const id = pieces[i].id;\r\n    const avisJSON = window.localStorage.getItem(`avis-piece-${id}`);\r\n    const avis = JSON.parse(avisJSON);\r\n    console.log(avis);\r\n\r\n    if (avis !== null) {\r\n        const pieceElement = document.querySelector(`article[data-id=\"${id}\"]`);\r\n        afficherAvis(pieceElement, avis);\r\n    }\r\n    \r\n}\r\n \r\n// Ajout du listener pour trier les pièces par ordre de prix croissant\r\nconst boutonTrier = document.querySelector(\".btn-trier\");\r\nboutonTrier.addEventListener(\"click\", () => {\r\n   const piecesOrdonnees = Array.from(pieces)\r\n   piecesOrdonnees.sort((a, b) => {\r\n       return a.prix - b.prix;\r\n   });\r\n  // Effacement de l'écran et regénération de la page\r\n  document.querySelector(\".fiches\").innerHTML = \"\";\r\n  genererPieces(piecesOrdonnees);\r\n});\r\n \r\n// Ajout du listener pour filtrer les pièces non abordables\r\nconst boutonFiltrer = document.querySelector(\".btn-filtrer\");\r\nboutonFiltrer.addEventListener(\"click\", () => {\r\n   const piecesFiltrees = pieces.filter((piece) => {\r\n       return piece.prix <= 35;\r\n   });\r\n   // Effacement de l'écran et regénération de la page avec les pièces filtrées uniquement\r\n  document.querySelector(\".fiches\").innerHTML = \"\";\r\n  genererPieces(piecesFiltrees);\r\n});\r\n\r\n\r\n//Tri decroissant\r\nconst boutonDecroissant = document.querySelector(\".btn-decroissant\");\r\n\r\nboutonDecroissant.addEventListener(\"click\", () => {\r\n    const piecesOrdonnees = Array.from(pieces);\r\n    piecesOrdonnees.sort( (a, b) => {\r\n        return b.prix - a.prix;\r\n     });\r\n    // Effacement de l'écran et regénération de la page\r\n    document.querySelector(\".fiches\").innerHTML = \"\";\r\n    genererPieces(piecesOrdonnees);\r\n});\r\n\r\n//Filtre par catégorie\r\nconst boutonNoDescription = document.querySelector(\".btn-nodesc\");\r\n\r\nboutonNoDescription.addEventListener(\"click\", () => {\r\n    const piecesFiltrees = pieces.filter( (piece) => {\r\n        return piece.description\r\n    });\r\n    // Effacement de l'écran et regénération de la page avec les pièces filtrées uniquement\r\n    document.querySelector(\".fiches\").innerHTML = \"\";\r\n    genererPieces(piecesFiltrees);\r\n});\r\n\r\n// Tableau des noms des pièces\r\nconst noms = pieces.map(piece => piece.nom);\r\nfor(let i = pieces.length -1 ; i >= 0; i--){\r\n    if(pieces[i].prix > 35){\r\n        noms.splice(i,1);\r\n    }\r\n}\r\nconsole.log(noms)\r\n\r\n//Création de la liste\r\nconst abordablesElements = document.createElement('ul');\r\n//Ajout de chaque nom à la liste\r\nfor(let i=0; i < noms.length ; i++){\r\n    const nomElement = document.createElement('li');\r\n    nomElement.innerText = noms[i];\r\n    abordablesElements.appendChild(nomElement);\r\n}\r\n// Ajout de l'en-tête puis de la liste au bloc résultats filtres\r\ndocument.querySelector('.abordables')\r\n    .appendChild(abordablesElements)\r\n\r\n//Code Exercice \r\nconst nomsDisponibles = pieces.map(piece => piece.nom);\r\nconst prixDisponibles = pieces.map(piece => piece.prix);\r\n\r\nfor(let i = pieces.length -1 ; i >= 0; i--){\r\n    if(pieces[i].disponibilite === false){\r\n        nomsDisponibles.splice(i,1);\r\n        prixDisponibles.splice(i,1);\r\n    }\r\n}\r\n\r\nconst disponiblesElement = document.createElement('ul');\r\n\r\nfor(let i=0 ; i < nomsDisponibles.length ; i++){\r\n    const nomElement = document.createElement('li');\r\n    nomElement.innerText = `${nomsDisponibles[i]} - ${prixDisponibles[i]} €`;\r\n    disponiblesElement.appendChild(nomElement);\r\n}\r\n\r\ndocument.querySelector('.disponibles').appendChild(disponiblesElement);\r\n\r\nconst inputPrixMax = document.querySelector('#prix-max')\r\ninputPrixMax.addEventListener('input', () =>{\r\n    const piecesFiltrees = pieces.filter((piece) =>{\r\n        return piece.prix <= inputPrixMax.value;\r\n    });\r\n    document.querySelector(\".fiches\").innerHTML = \"\";\r\n    genererPieces(piecesFiltrees);  \r\n})\r\n\r\n// Ajout du listener pour mettre à jour des données du localStorage\r\nconst boutonMettreAJour = document.querySelector(\".btn-maj\");\r\nboutonMettreAJour.addEventListener(\"click\", () => {\r\n  window.localStorage.removeItem(\"pieces\");\r\n  for (let i = 0; i < pieces.length; i++) {\r\n    window.localStorage.removeItem(\"avis-piece-\"+ pieces[i].id);\r\n  }\r\n  \r\n});\r\n\r\nafficherGraphiqueAvis();","/* global Chart */\r\n\r\nexport const ajoutListenersAvis = () => {\r\n    const piecesElements = document.querySelectorAll(\".fiches article button\");\r\n\r\n    for (let i = 0; i < piecesElements.length; i++) {\r\n      piecesElements[i].addEventListener(\"click\", async (event) => {\r\n        const id = event.target.dataset.id;\r\n\r\n        //tester si les avis sont déja present dans le localStorage\r\n            let avis = window.localStorage.getItem(`avis-piece-${id}`);\r\n            if (avis === null) {\r\n              /* Code de récupération des pièces depuis l’API HTTP */\r\n              avis = await fetch(\"http://localhost:8081/pieces/\" + id + \"/avis\").then(avis => avis.json());\r\n\r\n              // Transformation des pièces en JSON\r\n              const valeurAvis = JSON.stringify(avis);\r\n              // Stockage des informations dans le localStorage\r\n              window.localStorage.setItem(`avis-piece-${id}`, valeurAvis);\r\n            }else{\r\n                avis = JSON.parse(avis);\r\n            }\r\n\r\n\r\n        const pieceElement = event.target.parentElement;\r\n\r\n        afficherAvis(pieceElement, avis)\r\n\r\n        \r\n      });\r\n    }\r\n}\r\n\r\nexport const afficherAvis = (pieceElement, avis) => {\r\n    const avisElement = document.createElement(\"p\");\r\n    for (let i = 0; i < avis.length; i++) {\r\n        avisElement.innerHTML += `<b>${avis[i].utilisateur}:</b> ${avis[i].commentaire} <br>`;\r\n    }\r\n    pieceElement.appendChild(avisElement);\r\n}\r\n\r\nexport const ajoutListenerEnvoyerAvis = () => {\r\n  const formulaireAvis = document.querySelector(\".formulaire-avis\");\r\n  formulaireAvis.addEventListener(\"submit\", (event) => {\r\n\r\n    event.preventDefault();\r\n\r\n    // Création de l’objet du nouvel avis.\r\n    const avis = {\r\n      pieceId: parseInt(event.target.querySelector(\"input[name=piece-id]\").value),\r\n      utilisateur: event.target.querySelector(\"input[name=utilisateur\").value,\r\n      commentaire: event.target.querySelector(\"input[name=commentaire]\").value,\r\n      nbEtoiles: parseInt(event.target.querySelector(\"input[name=nbEtoiles]\").value)\r\n    }\r\n\r\n    const chargeUtile = JSON.stringify(avis);\r\n\r\n    fetch(\"http://localhost:8081/avis\", {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: chargeUtile\r\n    });\r\n\r\n  });\r\n}\r\n\r\nexport const afficherGraphiqueAvis = async () => {\r\n      // Calcul du nombre total de commentaires par quantité d'étoiles attribuées\r\n      const avis = await fetch(\"http://localhost:8081/avis\").then(avis => avis.json());\r\n      const nb_commentaires = [0, 0, 0, 0, 0];\r\n      for (let commentaire of avis) {\r\n        nb_commentaires[commentaire.nbEtoiles - 1]++;\r\n      }\r\n\r\n      const labels = [\"5\", \"4\", \"3\", \"2\", \"1\"];\r\n\r\n      const data = {\r\n        labels: labels,\r\n        datasets: [{\r\n        label: \"Étoiles attribuées\",\r\n        data: nb_commentaires.reverse(),\r\n          backgroundColor: \"rgb(238, 0, 0)\", // Couleur de fond\r\n        }],\r\n    };\r\n\r\n    // Objet de configuration final\r\n    const config = {\r\n      type: \"bar\",\r\n      data: data,\r\n      options: {\r\n        indexAxis: \"y\",\r\n      },\r\n    };\r\n\r\n    // Rendu du graphique dans l'élément canvas\r\n    new Chart(\r\n      document.querySelector(\"#graphique-avis\"),\r\n      config,\r\n    );\r\n\r\n    // Recuperation des pieces depuis le localStorage\r\n    const piecesJSON = window.localStorage.getItem(\"pieces\");\r\n\r\n    const pieces = JSON.parse(piecesJSON);\r\n\r\n    //Calcul du nombre de commentaire \r\n\r\n    let nbCommentairesDispo = 0;\r\n    let nbCommentairesNonDispo = 0;\r\n\r\n    for (let i = 0; i < avis.length; i++) {\r\n      const piece = pieces.find(piece => piece.id === avis[i].pieceId);\r\n      \r\n      if (piece) {\r\n        if(piece.disponibilite){\r\n          nbCommentairesDispo++;\r\n        }else{\r\n          nbCommentairesNonDispo++;\r\n        }\r\n      }\r\n    }\r\n\r\n    const labelsDispo = [\"Disponible\", \"Non disponible\"];\r\n\r\n    const dataDispo = {\r\n      labels: labelsDispo,\r\n      datasets: [{\r\n        label: \"Nombre de commentaires\",\r\n        data: [nbCommentairesDispo, nbCommentairesNonDispo],\r\n        backgroundColor: \"rgb(238, 0, 0)\",\r\n      }],\r\n    };\r\n\r\n    const configDispo = {\r\n      type: \"bar\",\r\n      data: dataDispo,\r\n    };\r\n\r\n    new Chart(\r\n      document.querySelector(\"#graphique-dispo\"),\r\n      configDispo,\r\n    );\r\n}\r\n  "],"names":["$44576fbb643b2cd8$export$c71b61ff869f11fb","piecesElements","document","querySelectorAll","i","length","addEventListener","event","id","target","dataset","avis","window","localStorage","getItem","fetch","then","json","valeurAvis","JSON","stringify","setItem","parse","pieceElement","parentElement","$44576fbb643b2cd8$export$333851ed8790b7cb","avisElement","createElement","innerHTML","utilisateur","commentaire","appendChild","$44576fbb643b2cd8$export$3e0393f287d43ee8","nb_commentaires","nbEtoiles","data","labels","datasets","label","reverse","backgroundColor","Chart","querySelector","type","options","indexAxis","piecesJSON","pieces","nbCommentairesDispo","nbCommentairesNonDispo","piece","find","pieceId","disponibilite","dataDispo","formulaireAvis","preventDefault","parseInt","value","chargeUtile","method","headers","body","$f7f2916509f4a77e$var$pieces","valeurPieces","$f7f2916509f4a77e$var$sectionFiches","$f7f2916509f4a77e$var$genererPieces","article","imageElement","src","image","nomElement","innerText","nom","prixElement","prix","categorieElement","categorie","descriptionElement","description","stockElement","avisBouton","textContent","avisJSON","console","log","$f7f2916509f4a77e$var$boutonTrier","piecesOrdonnees","Array","from","sort","a","b","$f7f2916509f4a77e$var$boutonFiltrer","piecesFiltrees","filter","$f7f2916509f4a77e$var$boutonDecroissant","$f7f2916509f4a77e$var$boutonNoDescription","$f7f2916509f4a77e$var$noms","map","splice","$f7f2916509f4a77e$var$abordablesElements","$f7f2916509f4a77e$var$nomsDisponibles","$f7f2916509f4a77e$var$prixDisponibles","$f7f2916509f4a77e$var$disponiblesElement","$f7f2916509f4a77e$var$inputPrixMax","$f7f2916509f4a77e$var$boutonMettreAJour","removeItem"],"version":3,"file":"index.18f85596.js.map"}