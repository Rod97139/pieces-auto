var e={},t=e&&e.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function l(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(l,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.afficherGraphiqueAvis=e.ajoutListenerEnvoyerAvis=e.afficherAvis=e.ajoutListenersAvis=void 0,e.ajoutListenersAvis=()=>{let n=document.querySelectorAll(".fiches article button");for(let i=0;i<n.length;i++)n[i].addEventListener("click",n=>t(void 0,void 0,void 0,function*(){let t=n.target.dataset.id,i=window.localStorage.getItem(`avis-piece-${t}`);if(null===i){i=yield fetch("http://localhost:8081/pieces/"+t+"/avis").then(e=>e.json());let e=JSON.stringify(i);window.localStorage.setItem(`avis-piece-${t}`,e)}else i=JSON.parse(i);let r=n.target.parentElement;(0,e.afficherAvis)(r,i)}))},e.afficherAvis=(e,t)=>{let n=document.createElement("p");for(let e=0;e<t.length;e++)n.innerHTML+=`<b>${t[e].utilisateur}:</b> ${t[e].commentaire} <br>`;e.appendChild(n)},e.ajoutListenerEnvoyerAvis=()=>{let e=document.querySelector(".formulaire-avis");e.addEventListener("submit",e=>{e.preventDefault();let t={pieceId:parseInt(e.target.querySelector("input[name=piece-id]").value),utilisateur:e.target.querySelector("input[name=utilisateur").value,commentaire:e.target.querySelector("input[name=commentaire]").value,nbEtoiles:parseInt(e.target.querySelector("input[name=nbEtoiles]").value)},n=JSON.stringify(t);fetch("http://localhost:8081/avis",{method:"POST",headers:{"Content-Type":"application/json"},body:n})})},e.afficherGraphiqueAvis=()=>t(void 0,void 0,void 0,function*(){let e=yield fetch("http://localhost:8081/avis").then(e=>e.json()),t=[0,0,0,0,0];for(let n of e)t[n.nbEtoiles-1]++;let n={labels:["5","4","3","2","1"],datasets:[{label:"\xc9toiles attribu\xe9es",data:t.reverse(),backgroundColor:"rgb(238, 0, 0)"}]};new Chart(document.querySelector("#graphique-avis"),{type:"bar",data:n,options:{indexAxis:"y"}});let i=window.localStorage.getItem("pieces"),r=JSON.parse(i),o=0,l=0;for(let t=0;t<e.length;t++){let n=r.find(n=>n.id===e[t].pieceId);n&&(n.disponibilite?o++:l++)}let a={labels:["Disponible","Non disponible"],datasets:[{label:"Nombre de commentaires",data:[o,l],backgroundColor:"rgb(238, 0, 0)"}]};new Chart(document.querySelector("#graphique-dispo"),{type:"bar",data:a})}),(0,e.ajoutListenerEnvoyerAvis)();let n=window.localStorage.getItem("pieces");if(null===n){n=await fetch("http://localhost:8081/pieces").then(e=>e.json());let e=JSON.stringify(n);window.localStorage.setItem("pieces",e)}else n=JSON.parse(n);const i=document.querySelector(".fiches"),r=t=>{for(let e=0;e<t.length;e++){let n=t[e],r=document.createElement("article");r.dataset.id=t[e].id;let o=document.createElement("img");o.src=n.image;let l=document.createElement("h2");l.innerText=n.nom;let a=document.createElement("p");a.innerText=`Prix: ${n.prix} € (${n.prix<35?"€":"€€€"})`;let c=document.createElement("p");c.innerText=n.categorie??"(aucune cat\xe9gorie)";let d=document.createElement("p");d.innerText=n.description??"Pas de description pour le moment.";let s=document.createElement("p");s.innerText=n.disponibilite?"En stock":"Rupture de stock";let u=document.createElement("button");u.dataset.id=n.id,u.textContent="Afficher les avis",i.appendChild(r),r.appendChild(o),r.appendChild(l),r.appendChild(a),r.appendChild(c),r.appendChild(d),r.appendChild(s),r.appendChild(u)}(0,e.ajoutListenersAvis)()};r(n);for(let t=0;t<n.length;t++){let i=n[t].id,r=window.localStorage.getItem(`avis-piece-${i}`),o=JSON.parse(r);if(console.log(o),null!==o){let t=document.querySelector(`article[data-id="${i}"]`);(0,e.afficherAvis)(t,o)}}const o=document.querySelector(".btn-trier");o.addEventListener("click",()=>{let e=Array.from(n);e.sort((e,t)=>e.prix-t.prix),document.querySelector(".fiches").innerHTML="",r(e)});const l=document.querySelector(".btn-filtrer");l.addEventListener("click",()=>{let e=n.filter(e=>e.prix<=35);document.querySelector(".fiches").innerHTML="",r(e)});const a=document.querySelector(".btn-decroissant");a.addEventListener("click",()=>{let e=Array.from(n);e.sort((e,t)=>t.prix-e.prix),document.querySelector(".fiches").innerHTML="",r(e)});const c=document.querySelector(".btn-nodesc");c.addEventListener("click",()=>{let e=n.filter(e=>e.description);document.querySelector(".fiches").innerHTML="",r(e)});const d=n.map(e=>e.nom);for(let e=n.length-1;e>=0;e--)n[e].prix>35&&d.splice(e,1);console.log(d);const s=document.createElement("ul");for(let e=0;e<d.length;e++){let t=document.createElement("li");t.innerText=d[e],s.appendChild(t)}document.querySelector(".abordables").appendChild(s);const u=n.map(e=>e.nom),p=n.map(e=>e.prix);for(let e=n.length-1;e>=0;e--)!1===n[e].disponibilite&&(u.splice(e,1),p.splice(e,1));const m=document.createElement("ul");for(let e=0;e<u.length;e++){let t=document.createElement("li");t.innerText=`${u[e]} - ${p[e]} €`,m.appendChild(t)}document.querySelector(".disponibles").appendChild(m);const h=document.querySelector("#prix-max");h.addEventListener("input",()=>{let e=n.filter(e=>e.prix<=h.value);document.querySelector(".fiches").innerHTML="",r(e)});const f=document.querySelector(".btn-maj");f.addEventListener("click",()=>{window.localStorage.removeItem("pieces");for(let e=0;e<n.length;e++)window.localStorage.removeItem("avis-piece-"+n[e].id)}),(0,e.afficherGraphiqueAvis)();
//# sourceMappingURL=index.a79fc9db.js.map
