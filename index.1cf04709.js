const e=()=>{let e=document.querySelectorAll(".fiches article button");for(let n=0;n<e.length;n++)e[n].addEventListener("click",async e=>{let n=e.target.dataset.id,l=window.localStorage.getItem(`avis-piece-${n}`);if(null===l){l=await fetch("http://localhost:8081/pieces/"+n+"/avis").then(e=>e.json());let e=JSON.stringify(l);window.localStorage.setItem(`avis-piece-${n}`,e)}else l=JSON.parse(l);let i=e.target.parentElement;t(i,l)})},t=(e,t)=>{let n=document.createElement("p");for(let e=0;e<t.length;e++)n.innerHTML+=`<b>${t[e].utilisateur}:</b> ${t[e].commentaire} <br>`;e.appendChild(n)},n=async()=>{let e=await fetch("http://localhost:8081/avis").then(e=>e.json()),t=[0,0,0,0,0];for(let n of e)t[n.nbEtoiles-1]++;let n={labels:["5","4","3","2","1"],datasets:[{label:"\xc9toiles attribu\xe9es",data:t.reverse(),backgroundColor:"rgb(238, 0, 0)"}]};new Chart(document.querySelector("#graphique-avis"),{type:"bar",data:n,options:{indexAxis:"y"}});let l=window.localStorage.getItem("pieces"),i=JSON.parse(l),r=0,o=0;for(let t=0;t<e.length;t++){let n=i.find(n=>n.id===e[t].pieceId);n&&(n.disponibilite?r++:o++)}let c={labels:["Disponible","Non disponible"],datasets:[{label:"Nombre de commentaires",data:[r,o],backgroundColor:"rgb(238, 0, 0)"}]};new Chart(document.querySelector("#graphique-dispo"),{type:"bar",data:c})};(()=>{let e=document.querySelector(".formulaire-avis");e.addEventListener("submit",e=>{e.preventDefault();let t={pieceId:parseInt(e.target.querySelector("input[name=piece-id]").value),utilisateur:e.target.querySelector("input[name=utilisateur").value,commentaire:e.target.querySelector("input[name=commentaire]").value,nbEtoiles:parseInt(e.target.querySelector("input[name=nbEtoiles]").value)},n=JSON.stringify(t);fetch("http://localhost:8081/avis",{method:"POST",headers:{"Content-Type":"application/json"},body:n})})})();let l=window.localStorage.getItem("pieces");const i=async()=>{if(null===l){l=await fetch("http://localhost:8081/pieces").then(e=>e.json());let e=JSON.stringify(l);window.localStorage.setItem("pieces",e)}else l=JSON.parse(l)};i();const r=document.querySelector(".fiches"),o=t=>{for(let e=0;e<t.length;e++){let n=t[e],l=document.createElement("article");l.dataset.id=t[e].id;let i=document.createElement("img");i.src=n.image;let o=document.createElement("h2");o.innerText=n.nom;let c=document.createElement("p");c.innerText=`Prix: ${n.prix} € (${n.prix<35?"€":"€€€"})`;let a=document.createElement("p");a.innerText=n.categorie??"(aucune cat\xe9gorie)";let d=document.createElement("p");d.innerText=n.description??"Pas de description pour le moment.";let s=document.createElement("p");s.innerText=n.disponibilite?"En stock":"Rupture de stock";let p=document.createElement("button");p.dataset.id=n.id,p.textContent="Afficher les avis",r?.appendChild(l),l.appendChild(i),l.appendChild(o),l.appendChild(c),l.appendChild(a),l.appendChild(d),l.appendChild(s),l.appendChild(p)}e()};o(l);for(let e=0;e<l.length;e++){let n=l[e].id,i=window.localStorage.getItem(`avis-piece-${n}`),r=JSON.parse(i);if(console.log(r),null!==r){let e=document.querySelector(`article[data-id="${n}"]`);t(e,r)}}const c=document.querySelector(".btn-trier");c.addEventListener("click",()=>{let e=Array.from(l);e.sort((e,t)=>e.prix-t.prix),document.querySelector(".fiches").innerHTML="",o(e)});const a=document.querySelector(".btn-filtrer");a.addEventListener("click",()=>{let e=l.filter(e=>e.prix<=35);document.querySelector(".fiches").innerHTML="",o(e)});const d=document.querySelector(".btn-decroissant");d.addEventListener("click",()=>{let e=Array.from(l);e.sort((e,t)=>t.prix-e.prix),document.querySelector(".fiches").innerHTML="",o(e)});const s=document.querySelector(".btn-nodesc");s.addEventListener("click",()=>{let e=l.filter(e=>e.description);document.querySelector(".fiches").innerHTML="",o(e)});const p=l.map(e=>e.nom);for(let e=l.length-1;e>=0;e--)l[e].prix>35&&p.splice(e,1);console.log(p);const u=document.createElement("ul");for(let e=0;e<p.length;e++){let t=document.createElement("li");t.innerText=p[e],u.appendChild(t)}document.querySelector(".abordables").appendChild(u);const m=l.map(e=>e.nom),h=l.map(e=>e.prix);for(let e=l.length-1;e>=0;e--)!1===l[e].disponibilite&&(m.splice(e,1),h.splice(e,1));const g=document.createElement("ul");for(let e=0;e<m.length;e++){let t=document.createElement("li");t.innerText=`${m[e]} - ${h[e]} €`,g.appendChild(t)}document.querySelector(".disponibles").appendChild(g);const f=document.querySelector("#prix-max");f.addEventListener("input",()=>{let e=l.filter(e=>e.prix<=f.value);document.querySelector(".fiches").innerHTML="",o(e)});const S=document.querySelector(".btn-maj");S.addEventListener("click",()=>{window.localStorage.removeItem("pieces");for(let e=0;e<l.length;e++)window.localStorage.removeItem("avis-piece-"+l[e].id)}),n();
//# sourceMappingURL=index.1cf04709.js.map
